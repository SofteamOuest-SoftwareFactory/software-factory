apiVersion: certmanager.k8s.io/v1alpha1
kind: Certificate
metadata:
  name: certificate
spec:
  secretName: certificate
  issuerRef:
    name: letsencrypt-issuer
    kind: Issuer
  commonName: {{certificates | selectattr("namespace", "match", namespace_item) | map(attribute='name') | first }}
  dnsNames:
{% for certificate in certificates if certificate.namespace == namespace_item %}
  - {{certificate.name}}
{% endfor %}
  acme:
    config:
    - http01:
        ingressClass: nginx
      domains:
  {% for certificate in certificates if certificate.namespace == namespace_item  %}
        - {{certificate.name}}
  {% endfor %}